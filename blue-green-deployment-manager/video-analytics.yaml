


apiVersion: v1
kind: ConfigMap
metadata:
  name: video-analytics-0
  namespace: default
  labels: 
    "cpu_threshold_1": "100"
    "cpu_threshold_2" : "300"
    "mm_threshold_1" : "100000000"
    "mm_threshold_2" : "10000000000"
    "function_name" : "video-analytics"
    "kind" : "mmap"
data:
  my-config.json: |
    [
        {
          "endpoints": "video-decoder",
          "name": "video-streaming",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-streaming:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "HTTP"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, 
            {
            "name": "RPC_PV",
            "value": "/macropod-pv"
            }, 
            {
            "name": "RPC_DEST_PV",
            "value": "/macropod-pv"
            }, 
            {
              "name": "FUNC_PORT",
              "value": "5000"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 80,
            "targetPort": 5000
          },
          "ingress": {
            "host": "b.example.com"
          }
        },
        {
          "name": "video-recog",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-recog:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, 
            {
              "name": "FUNC_PORT",
              "value": "5002"
            },
            {
              "name": "APP_PV",
              "value": "/macropod-pv"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 5002,
            "targetPort": 5002
          }
        },
        {
          "endpoints": "video-recog",
          "name": "video-decoder",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-decoder:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, 
            {
            "name": "RPC_PV",
            "value": "/macropod-pv"
            },
            {
            "name": "RPC_DEST_PV",
            "value": "/macropod-pv"
            },
            {
            "name": "APP_PV",
            "value": "/macropod-pv"
            },
            {
              "name": "FUNC_PORT",
              "value": "5001"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 5001,
            "targetPort": 5001
          }
        }
      ]


---





apiVersion: v1
kind: ConfigMap
metadata:
  name: video-analytics-1
  namespace: default
  labels: 
    "cpu_threshold_1": "100"
    "cpu_threshold_2" : "3200"
    "mm_threshold_1" : "100000000"
    "mm_threshold_2" : "10000000000"
    "function_name" : "video-analytics"
    "kind" : "single-pod"
data:
  my-config.json: |
    [
        {
          "endpoints": "video-decoder",
          "name": "video-streaming",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-streaming:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "HTTP"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5000"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 80,
            "targetPort": 5000
          },
          "ingress": {
            "host": "b.example.com"
          }
        },
        {
          "name": "video-recog",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-recog:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5002"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 5002,
            "targetPort": 5002
          }
        },
        {
          "endpoints": "video-recog",
          "name": "video-decoder",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-decoder:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5001"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 5001,
            "targetPort": 5001
          }
        }
      ]




---

apiVersion: v1
kind: ConfigMap
metadata:
  name: video-analytics-2
  namespace: default
  labels: 
    "cpu_threshold_1": "200000"
    "cpu_threshold_2" : "4000000"
    "mm_threshold_1" : "100000000"
    "mm_threshold_2" : "10000000000"
    "function_name" : "video-analytics"
    "kind" : "multi-pod"
data:
  my-config.json: |
    [
        {
          "endpoints": "video-decoder",
          "name": "video-streaming",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-streaming:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "HTTP"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5000"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 443,
            "targetPort": 5000
          },
          "ingress": {
            "host": "b.example.com"
          }
        },
        {
          "name": "video-recog",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-recog:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5000"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 443,
            "targetPort": 5000
          }
        },
        {
          "endpoints": "video-recog",
          "name": "video-decoder",
          "version": 1,
          "replicaCount": 1,
          "image": {
            "image": "arearnest7/video-decoder:macropod",
            "pullPolicy": "IfNotPresent"
          },
          "env": [{
            "name": "SERVICE_TYPE",
            "value": "GRPC"
            },
            {
            "name": "GRPC_THREAD",
            "value": "10"
            }, {
              "name": "FUNC_PORT",
              "value": "5000"
            }
          ],
          "service": {
            "type": "ClusterIP",
            "port": 443,
            "targetPort": 5000
          }
        }
      ]





hey -n 1000 -c 10 http://127.0.0.1:8082/video-analytics